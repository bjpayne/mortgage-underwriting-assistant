{% extends 'master.html' %}
{% block content %}
<h3 class="mb-2">AutoWrite Score</h3>
{% if status == 0 %}
    <p class="lead">Recommendation: <span class="text-danger">Deny</span></p>
{% elif status == 1 %}
    <p class="lead">Recommendation: <span class="text-success">Approve</span></p>
{% endif %}
<pre>{{ form_data }}</pre>

<div id="result-plots" class="row mb-5">
    <!-- Pre approval -->
    <div class="col-sm-12 col-md-3 mb-3 d-flex">
        <div class="card flex-grow-1">
            <h5 class="card-header d-flex justify-content-between align-items-center">
                <span>Pre Approved?</span> <span>{{ 'No' if form_data['pre_approval'] == '0' else 'Yes' }}</span>
            </h5>
            <div class="card-body">
                <div id="pre-approval-plot"></div>
                <div class="card-notes d-flex justify-content-between align-items-center">
                    <span>{{ pre_approval_notes }}</span>
                    <i class="bi bi-fullscreen fullscreen-plot" data-bs-toggle="modal"
                       data-bs-target="#pre-approval-fullscreen" title="Fullscreen"
                    ></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Line of credit -->
    <div class="col-sm-12 col-md-3 mb-3 d-flex">
        <div class="card flex-grow-1">
            <h5 class="card-header d-flex justify-content-between align-items-center">
                <span>Line of credit?</span> <span>{{ 'No' if form_data['line_of_credit'] == '0' else 'Yes' }}</span>
            </h5>
            <div class="card-body">
                <div id="line-of-credit-plot"></div>
                <div class="card-notes d-flex justify-content-between align-items-center">
                    <span>{{ line_of_credit_notes }}</span>
                    <i class="bi bi-fullscreen fullscreen-plot" data-bs-toggle="modal"
                       data-bs-target="#line-of-credit-fullscreen" title="Fullscreen"
                    ></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Negative amortization -->
    <div class="col-sm-12 col-md-3 mb-3 d-flex">
        <div class="card flex-grow-1">
            <h5 class="card-header d-flex justify-content-between align-items-center">
                <span>Negative amortization?</span> <span>{{ 'No' if form_data['negative_amortization'] == '0' else 'Yes' }}</span>
            </h5>
            <div class="card-body">
                <div id="negative-amortization-plot"></div>
                <div class="card-notes">{{ negative_amortization_notes }}</div>
            </div>
        </div>
    </div>

    <!-- Upfront charges -->
    <div class="col-sm-12 col-md-3 mb-3 d-flex">
        <div class="card flex-grow-1">
            <h5 class="card-header d-flex justify-content-between align-items-center">
                <span>Upfront charges:</span> <span>{{ form_data['upfront_charges'] }}</span>
            </h5>
            <div class="card-body">
                <div id="upfront-charges-plot"></div>
                <div class="card-notes">{{ upfront_charges_notes }}</div>
            </div>
        </div>
    </div>

    <!-- Interest only -->
    <div class="col-sm-12 col-md-3 mb-3 d-flex">
        <div class="card flex-grow-1">
            <h5 class="card-header d-flex justify-content-between align-items-center">
                <span>Interest only?</span> <span>{{ 'No' if form_data['interest_only'] == '0' else 'Yes' }}</span>
            </h5>
            <div class="card-body">
                <div id="interest-only-plot"></div>
                <div class="card-notes">{{ interest_only_notes }}</div>
            </div>
        </div>
    </div>

    <!-- Income -->
    <div class="col-sm-12 col-md-3 mb-3 d-flex">
        <div class="card flex-grow-1">
            <h5 class="card-header d-flex justify-content-between align-items-center">
                <span>Income:</span> <span>{{ form_data['income'] }}</span>
            </h5>
            <div class="card-body">
                <div id="income-plot"></div>
                <div class="card-notes">{{ income_notes }}</div>
            </div>
        </div>
    </div>

    <!-- Credit score -->
    <div class="col-sm-12 col-md-3 mb-3 d-flex">
        <div class="card flex-grow-1">
            <h5 class="card-header d-flex justify-content-between align-items-center">
                <span>Credit score:</span> <span>{{ form_data['credit_score'] }}</span>
            </h5>
            <div class="card-body">
                <div id="credit-score-plot"></div>
                <div class="card-notes">{{ credit_score_notes }}</div>
            </div>
        </div>
    </div>

    <!-- Property value -->
    <div class="col-sm-12 col-md-3 mb-3 d-flex">
        <div class="card flex-grow-1">
            <h5 class="card-header d-flex justify-content-between align-items-center">
                <span>Property value:</span> <span>{{ form_data['property_value'] }}</span>
            </h5>
            <div class="card-body">
                <div id="property-value-plot"></div>
                <div class="card-notes">{{ property_value_notes }}</div>
            </div>
        </div>
    </div>
</div>

<div id="fullscreen-result-plots">
    <!-- Pre approval fullscreen -->
    <div class="modal fade" id="pre-approval-fullscreen" tabindex="-1" aria-labelledby="pre-approval-fullscreen-title" aria-hidden="true">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title d-flex justify-content-between align-items-center w-100"
                        id="pre-approval-fullscreen-title"
                    >
                        <span>Pre Approved?</span> <span>{{ 'No' if form_data['pre_approval'] == '0' else 'Yes' }}</span>
                    </h5>
                </div>
                <div class="modal-body d-flex align-items-center justify-content-around">
                    <div id="pre-approval-plot-fullscreen"></div>
                </div>
                <div class="modal-footer">
                    <i class="bi bi-fullscreen-exit" title="Exit fullscreen" data-bs-dismiss="modal"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Line of credit fullscreen -->
    <div class="modal fade" id="line-of-credit-fullscreen" tabindex="-1"
         aria-labelledby="line-of-credit-fullscreen-title" aria-hidden="true"
    >
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title d-flex justify-content-between align-items-center w-100"
                        id="line-of-credit-fullscreen-title"
                    >
                        <span>Line of credit?</span> <span>{{ 'No' if form_data['line_of_credit'] == '0' else 'Yes' }}</span>
                    </h5>
                </div>
                <div class="modal-body d-flex align-items-center justify-content-around">
                    <div id="line-of-credit-plot-fullscreen"></div>
                </div>
                <div class="modal-footer">
                    <i class="bi bi-fullscreen-exit" title="Exit fullscreen" data-bs-dismiss="modal"></i>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block page_scripts %}
<script>
    let layout = {
        height: 300,
        width: 300,
        font: {
            family: 'monospace',
            size: 10,
        }
    };

    let layoutFullscreen = {
        height: 700,
        width: 700,
        font: {
            family: 'monospace',
            size: 14,
        }
    };

    // Pre approval
    (function () {
        let values = [
            {{ dataset[dataset['status'] == status]['pre_approval'].value_counts()[1] }},
            {{ dataset[dataset['status'] == status]['pre_approval'].value_counts()[0] }},
        ]

        let data = [{
            values: values,
            labels: ['Yes', 'No'],
            type: 'pie',
            marker: {
                colors: ['#33cccc', '#3b9b9b']
            }
        }];

        Plotly.newPlot('pre-approval-plot', data, layout);
        Plotly.newPlot('pre-approval-plot-fullscreen', data, layoutFullscreen);
    })();

    // Line of credit
    (function () {
        let values = [
            {{ dataset[dataset['status'] == status]['line_of_credit'].value_counts()[1] }},
            {{ dataset[dataset['status'] == status]['line_of_credit'].value_counts()[0] }},
        ]

        let data = [{
            values: values,
            labels: ['Yes', 'No'],
            type: 'pie',
            marker: {
                colors: ['#33cccc', '#3b9b9b']
            }
        }];

        Plotly.newPlot('line-of-credit-plot', data, layout);
        Plotly.newPlot('line-of-credit-plot-fullscreen', data, layoutFullscreen);
    })();

    // Negative amortization
    (function () {
        let values = [
            {{ dataset[dataset['status'] == status]['negative_amortization'].value_counts()[1] }},
            {{ dataset[dataset['status'] == status]['negative_amortization'].value_counts()[0] }},
        ]

        let data = [{
            values: values,
            labels: ['Yes', 'No'],
            type: 'pie',
            marker: {
                colors: ['#33cccc', '#3b9b9b']
            }
        }];

        Plotly.newPlot('negative-amortization-plot', data, layout);
    })();

    // Upfront charges
    (function () {
        let x = {{ upfront_charges_data['x'] }}
        let y = {{ upfront_charges_data['y'] }}

        let data = [{
            x: x,
            y: y,
            type: 'bar',
            marker: {
                color: '#33cccc'
            }
        }];

        // clone layout object
        let _layout = {...layout}

        _layout['title'] = 'Apps by upfront charge range';

        Plotly.newPlot('upfront-charges-plot', data, _layout);
    })();

    // Interest only
    (function () {
        let values = [
            {{ dataset[dataset['status'] == status]['interest_only'].value_counts()[1] }},
            {{ dataset[dataset['status'] == status]['interest_only'].value_counts()[0] }},
        ]

        let data = [{
            values: values,
            labels: ['Yes', 'No'],
            type: 'pie',
            marker: {
                colors: ['#33cccc', '#3b9b9b']
            }
        }];

        Plotly.newPlot('interest-only-plot', data, layout);
    })();

    // Income
    (function () {
        let x = {{ income_data['x'] }}
        let y = {{ income_data['y'] }}

        let data = [{
            x: x,
            y: y,
            type: 'bar',
            marker: {
                color: '#33cccc'
            }
        }];

        // clone layout object
        let _layout = {...layout}

        _layout['title'] = 'Apps by income range';

        Plotly.newPlot('income-plot', data, _layout);
    })();

    // Credit score
    (function () {
        let x = {{ credit_score_data['x'] }}
        let y = {{ credit_score_data['y'] }}

        let data = [{
            x: x,
            y: y,
            type: 'bar',
            marker: {
                color: '#33cccc'
            }
        }];

        // clone layout object
        let _layout = {...layout}

        _layout['title'] = 'Apps by credit score';

        Plotly.newPlot('credit-score-plot', data, _layout);
    })();

    // Property value
    (function () {
        let x = {{ property_value_data['x'] }}
        let y = {{ property_value_data['y'] }}

        let data = [{
            x: x,
            y: y,
            type: 'bar',
            marker: {
                color: '#33cccc'
            }
        }];

        // clone layout object
        let _layout = {...layout}

        _layout['title'] = 'Apps by property value ranges';

        Plotly.newPlot('property-value-plot', data, _layout);
    })();
</script>
{% endblock %}
